import streamlit as st
import os
from PIL import Image
import base64
from datetime import datetime
import pandas as pd

st.set_page_config(page_title="ë¸”ë£¨í‘¸ë“œ ì„ í˜¸ë„ ì¡°ì‚¬", page_icon="ğŸŒŠ", layout="wide")

# âœ… ì¹´í…Œê³ ë¦¬ë³„ ìˆ˜ì‚°ë¬¼
INGREDIENT_CATEGORIES = {
    'ğŸ¤ ê°€ê³µìˆ˜ì‚°ë¬¼': ['ë§›ì‚´', 'ì–´ë€', 'ì–´ë¬µ', 'ì¥í¬'],
    'ğŸŒ¿ í•´ì¡°ë¥˜': ['ê¹€', 'ë‹¤ì‹œë§ˆ', 'ë§¤ìƒì´', 'ë¯¸ì—­', 'íŒŒë˜', 'í†³'],
    'ğŸ¦‘ ì—°ì²´ë¥˜': ['ê¼´ëšœê¸°', 'ë‚™ì§€', 'ë¬¸ì–´', 'ì˜¤ì§•ì–´', 'ì£¼ê¾¸ë¯¸'],
    'ğŸ¦€ ê°‘ê°ë¥˜': ['ê°€ì¬', 'ê²Œ', 'ìƒˆìš°'],
    'ğŸš íŒ¨ë¥˜': ['ë‹¤ìŠ¬ê¸°', 'ê¼¬ë§‰', 'ê°€ë¦¬ë¹„', 'ê³¨ë±…ì´', 'êµ´', 'ë¯¸ë”ë•', 'ë°”ì§€ë½', 'ë°±í•©', 'ì†Œë¼', 'ì¬ì²©', 'ì „ë³µ', 'í™í•©'],
    'ğŸŸ ì–´ë¥˜': ['ê°€ìë¯¸', 'ë‹¤ë‘ì–´', 'ê³ ë“±ì–´', 'ê°ˆì¹˜', 'ê½ì¹˜', 'ëŒ€êµ¬', 'ë©¸ì¹˜', 'ëª…íƒœ', 'ë°•ëŒ€', 'ë±…ì–´', 'ë³‘ì–´', 'ì‚¼ì¹˜', 'ì•„ê·€', 'ì—°ì–´', 'ì„ì—°ìˆ˜', 'ì¥ì–´', 'ì¡°ê¸°']
}

IMAGE_PATH = "images/ingredients"
MENU_IMAGE_PATH = "images/menus"

# âœ… ë©”ë‰´ ë°ì´í„° ì˜ˆì‹œ (ê°„ë‹¨)
# ìˆ˜ì‚°ë¬¼ë³„ ë©”ë‰´ ë°ì´í„°
MENU_DATA = {
    'ë§›ì‚´': {
        'ë°¥/ì£½': ['ê²Œë§›ì‚´ë³¶ìŒë°¥'],
        'ë¬´ì¹¨': ['ê²Œë§›ì‚´ì½©ë‚˜ë¬¼ë¬´ì¹¨'],
        'ë³¶ìŒ': ['ë§›ì‚´ë³¶ìŒ'],
        'ë¶€ì¹¨': ['ë§›ì‚´ì „']
    },
    'ì–´ë€': {
        'ë°¥/ì£½': ['ë‚ ì¹˜ì•Œë°¥'],
        'ë©´ë¥˜': ['ëª…ë€íŒŒìŠ¤íƒ€'],
        'êµ­/íƒ•': ['ì•Œíƒ•'],
        'ì°œ': ['ë‚ ì¹˜ì•Œë‹¬ê±€ì°œ'],
        'ë¬´ì¹¨': ['ëª…ë€ì “ê°ˆ'],
        'ë³¶ìŒ': ['ë‚ ì¹˜ì•ŒìŠ¤í¬ë¨ë¸”ì—ê·¸'],
        'ë¶€ì¹¨': ['ë‚ ì¹˜ì•Œê³„ë€ë§ì´'],
        'êµ¬ì´': ['ëª…ë€êµ¬ì´']
    },
    'ì–´ë¬µ': {
        'ë°¥/ì£½': ['ì–´ë¬µë³¶ìŒë°¥'],
        'ë©´ë¥˜': ['ì–´ë¬µìš°ë™'],
        'êµ­/íƒ•': ['ì–´ë¬µíƒ•'],
        'ì¡°ë¦¼': ['ì–´ë¬µì¡°ë¦¼'],
        'ì°œ': ['ì½©ë‚˜ë¬¼ì–´ë¬µì°œ', 'ì–´ë¬µì°œ'],
        'ë³¶ìŒ': ['ë§¤ì½¤ì–´ë¬µë³¶ìŒ', 'ê°„ì¥ì–´ë¬µë³¶ìŒ'],
        'ë¶€ì¹¨': ['ì–´ë¬µì „'],
        'íŠ€ê¹€': ['ì–´ë¬µê³ ë¡œì¼€']
    },
    'ì¥í¬': {
        'ì¡°ë¦¼': ['ì¥í¬ì¡°ë¦¼'],
        'ë¬´ì¹¨': ['ì¥í¬ë¬´ì¹¨'],
        'ë³¶ìŒ': ['ì¥í¬ë³¶ìŒ'],
        'ë¶€ì¹¨': ['ì¥í¬ì „'],
        'íŠ€ê¹€': ['ì¥í¬íŠ€ê¹€'],
        'êµ¬ì´': ['ì¥í¬êµ¬ì´']
    },
    'ê¹€': {
        'ë°¥/ì£½': ['ê¹€ë°¥'],
        'ë¬´ì¹¨': ['ê¹€ë¬´ì¹¨'],
        'íŠ€ê¹€': ['ê¹€ë¶€ê°'],
        'êµ¬ì´': ['ê¹€ìë°˜']
    },
    'ë‹¤ì‹œë§ˆ': {
        'ë¬´ì¹¨': ['ë‹¤ì‹œë§ˆì±„ë¬´ì¹¨'],
        'ë³¶ìŒ': ['ë‹¤ì‹œë§ˆì±„ë³¶ìŒ'],
        'íŠ€ê¹€': ['ë‹¤ì‹œë§ˆíŠ€ê°']
    },
    'ë§¤ìƒì´': {
        'ë©´ë¥˜': ['ë§¤ìƒì´ì¹¼êµ­ìˆ˜'],
        'êµ­/íƒ•': ['ë§¤ìƒì´êµ´êµ­'],
        'ë¶€ì¹¨': ['ë§¤ìƒì´ì „']
    },
    'ë¯¸ì—­': {
        'ë°¥/ì£½': ['ë¯¸ì—­êµ­ë°¥'],
        'êµ­/íƒ•': ['ë¯¸ì—­êµ­'],
        'ë¬´ì¹¨': ['ë¯¸ì—­ì´ˆë¬´ì¹¨'],
        'ë³¶ìŒ': ['ë¯¸ì—­ì¤„ê¸°ë³¶ìŒ']
    },
    'íŒŒë˜': {
        'ë¬´ì¹¨': ['íŒŒë˜ë¬´ì¹¨'],
        'ë³¶ìŒ': ['íŒŒë˜ë³¶ìŒ'],
        'ë¶€ì¹¨': ['ë¬¼íŒŒë˜ì „']
    },
    'í†³': {
        'ë°¥/ì£½': ['í†³ë°¥'],
        'ë¬´ì¹¨': ['í†³ë¬´ì¹¨']
    },
    'ê¼´ëšœê¸°': {
        'ì¡°ë¦¼': ['ê¼´ëšœê¸°ì¡°ë¦¼'],
        'ì°œ': ['ê¼´ëšœê¸°ì°œ'],
        'ë¬´ì¹¨': ['ê¼´ëšœê¸°ì “ë¬´ì¹¨'],
        'ë³¶ìŒ': ['ê¼´ëšœê¸°ë³¶ìŒ']
    },
    'ë‚™ì§€': {
        'ë°¥/ì£½': ['ë‚™ì§€ë¹„ë¹”ë°¥'],
        'ë©´ë¥˜': ['ë‚™ì§€ìˆ˜ì œë¹„'],
        'êµ­/íƒ•': ['ë‚™ì§€ì—°í¬íƒ•'],
        'ì°œ': ['ë‚™ì§€ì°œ'],
        'ë¬´ì¹¨': ['ë‚™ì§€ì´ˆë¬´ì¹¨'],
        'ë³¶ìŒ': ['ë‚™ì§€ë³¶ìŒ'],
        'êµ¬ì´': ['ë‚™ì§€í˜¸ë¡±êµ¬ì´'],
        'ê¸°íƒ€(ìƒì‹)': ['ë‚™ì§€íƒ•íƒ•ì´']
    },
    'ë¬¸ì–´': {
        'ë°¥/ì£½': ['ë¬¸ì–´ë³¶ìŒë°¥'],
        'ë©´ë¥˜': ['ë¬¸ì–´ë¼ë©´'],
        'êµ­/íƒ•': ['ë¬¸ì–´íƒ•'],
        'ì¡°ë¦¼': ['ë¬¸ì–´ì¡°ë¦¼'],
        'ì°œ': ['ë¬¸ì–´ì½©ë‚˜ë¬¼ì°œ'],
        'ë¬´ì¹¨': ['ë¬¸ì–´ì´ˆë¬´ì¹¨'],
        'ë³¶ìŒ': ['ë¬¸ì–´ë³¶ìŒ'],
        'ë¶€ì¹¨': ['ë¬¸ì–´ì „'],
        'íŠ€ê¹€': ['ë¬¸ì–´íŠ€ê¹€'],
        'ê¸°íƒ€(ìƒì‹)': ['ë¬¸ì–´íšŒ']
    },
    'ì˜¤ì§•ì–´': {
        'ë°¥/ì£½': ['ì˜¤ì§•ì–´ë®ë°¥'],
        'êµ­/íƒ•': ['ì˜¤ì§•ì–´ë¬´êµ­'],
        'ì¡°ë¦¼': ['ì˜¤ì§•ì–´ì¡°ë¦¼'],
        'ì°œ': ['ì˜¤ì§•ì–´ì½©ë‚˜ë¬¼ì°œ', 'ì˜¤ì§•ì–´ìˆ™íšŒ'],
        'ë¬´ì¹¨': ['ì˜¤ì§•ì–´ì´ˆë¬´ì¹¨'],
        'ë³¶ìŒ': ['ì˜¤ì§•ì–´ë³¶ìŒ'],
        'ë¶€ì¹¨': ['ì˜¤ì§•ì–´í•´ë¬¼ì „'],
        'íŠ€ê¹€': ['ì˜¤ì§•ì–´íŠ€ê¹€'],
        'êµ¬ì´': ['ì˜¤ì§•ì–´ë²„í„°êµ¬ì´'],
        'ê¸°íƒ€(ìƒì‹)': ['ì˜¤ì§•ì–´íšŒ']
    },
    'ì£¼ê¾¸ë¯¸': {
        'ë°¥/ì£½': ['ì£¼ê¾¸ë¯¸ë³¶ìŒë®ë°¥'],
        'ë©´ë¥˜': ['ì£¼ê¾¸ë¯¸ê°ììˆ˜ì œë¹„', 'ì£¼ê¾¸ë¯¸ì§¬ë½•'],
        'êµ­/íƒ•': ['ì£¼ê¾¸ë¯¸ì—°í¬íƒ•'],
        'ì°œ': ['ì£¼ê¾¸ë¯¸ìˆ™íšŒ', 'ì£¼ê¾¸ë¯¸ì°œ'],
        'ë¬´ì¹¨': ['ì£¼ê¾¸ë¯¸ë¬´ì¹¨'],
        'ë³¶ìŒ': ['ì£¼ê¾¸ë¯¸ë³¶ìŒ']
    },
    'ê°€ì¬': {
        'ì°œ': ['ê°€ì¬ì°œ'],
        'êµ¬ì´': ['ê°€ì¬êµ¬ì´']
    },
    'ê²Œ': {
        'ë°¥/ì£½': ['ê²Œì‚´ë³¶ìŒë°¥'],
        'ë©´ë¥˜': ['ê²Œì‚´íŒŒìŠ¤íƒ€', 'ê½ƒê²Œë¼ë©´'],
        'êµ­/íƒ•': ['ê½ƒê²Œíƒ•'],
        'ì¡°ë¦¼': ['ê½ƒê²Œì¡°ë¦¼'],
        'ì°œ': ['ê½ƒê²Œì°œ'],
        'ë¬´ì¹¨': ['ê½ƒê²Œë¬´ì¹¨'],
        'ë³¶ìŒ': ['ê½ƒê²Œë³¶ìŒ'],
        'íŠ€ê¹€': ['ê½ƒê²Œê°•ì •'],
        'ê¸°íƒ€(ìƒì‹)': ['ê°„ì¥ê²Œì¥', 'ì–‘ë…ê²Œì¥']
    },
    'ìƒˆìš°': {
        'ë°¥/ì£½': ['ìƒˆìš°ë³¶ìŒë°¥'],
        'ë©´ë¥˜': ['ìƒˆìš°í¬ë¦¼íŒŒìŠ¤íƒ€'],
        'êµ­/íƒ•': ['ìƒˆìš°ë‹¬ê±€êµ­', 'ì–¼í°ìƒˆìš°ë§¤ìš´íƒ•'],
        'ì¡°ë¦¼': ['ìƒˆìš°ì¡°ë¦¼'],
        'ì°œ': ['ìƒˆìš°ë‹¬ê±€ì°œ'],
        'ë¬´ì¹¨': ['ìƒˆìš°ì “'],
        'ë³¶ìŒ': ['ê±´ìƒˆìš°ë³¶ìŒ'],
        'ë¶€ì¹¨': ['ìƒˆìš°ì „'],
        'íŠ€ê¹€': ['ìƒˆìš°íŠ€ê¹€'],
        'êµ¬ì´': ['ìƒˆìš°ë²„í„°êµ¬ì´'],
        'ê¸°íƒ€(ìƒì‹)': ['ê°„ì¥ìƒˆìš°ì¥', 'ì–‘ë…ìƒˆìš°ì¥']
    },
    'ë‹¤ìŠ¬ê¸°': {
        'ë©´ë¥˜': ['ë‹¤ìŠ¬ê¸°ìˆ˜ì œë¹„'],
        'êµ­/íƒ•': ['ë‹¤ìŠ¬ê¸°ëœì¥êµ­'],
        'ë¬´ì¹¨': ['ë‹¤ìŠ¬ê¸°ë¬´ì¹¨'],
        'ë¶€ì¹¨': ['ë‹¤ìŠ¬ê¸°íŒŒì „']
    },
    'ê¼¬ë§‰': {
        'ë°¥/ì£½': ['ê¼¬ë§‰ë¹„ë¹”ë°¥'],
        'ë©´ë¥˜': ['ê¼¬ë§‰ì¹¼êµ­ìˆ˜'],
        'êµ­/íƒ•': ['ê¼¬ë§‰ëœì¥ì°Œê°œ'],
        'ì°œ': ['ê¼¬ë§‰ì°œ'],
        'ë¬´ì¹¨': ['ê¼¬ë§‰ë¬´ì¹¨'],
        'ë¶€ì¹¨': ['ê¼¬ë§‰ì „'],
        'êµ¬ì´': ['ê¼¬ë§‰ë–¡ê¼¬ì¹˜êµ¬ì´']
    },
    'ê°€ë¦¬ë¹„': {
        'ë°¥/ì£½': ['ê°€ë¦¬ë¹„ì´ˆë°¥'],
        'ë©´ë¥˜': ['ê°€ë¦¬ë¹„ì¹¼êµ­ìˆ˜'],
        'êµ­/íƒ•': ['ê°€ë¦¬ë¹„íƒ•'],
        'ì°œ': ['ê°€ë¦¬ë¹„ì°œ'],
        'ë¬´ì¹¨': ['ê°€ë¦¬ë¹„ì´ˆë¬´ì¹¨'],
        'ë³¶ìŒ': ['ê°€ë¦¬ë¹„ë³¶ìŒ'],
        'êµ¬ì´': ['ê°€ë¦¬ë¹„ë²„í„°êµ¬ì´']
    },
    'ê³¨ë±…ì´': {
        'ë°¥/ì£½': ['ê³¨ë±…ì´ì£½'],
        'ë©´ë¥˜': ['ê³¨ë±…ì´ë¹„ë¹”ë©´'],
        'êµ­/íƒ•': ['ê³¨ë±…ì´íƒ•'],
        'ë¬´ì¹¨': ['ê³¨ë±…ì´ë¬´ì¹¨'],
        'ë³¶ìŒ': ['ê³¨ë±…ì´ë³¶ìŒ'],
        'íŠ€ê¹€': ['ê³¨ë±…ì´íŠ€ê¹€'],
        'êµ¬ì´': ['ê³¨ë±…ì´ê¼¬ì¹˜êµ¬ì´'],
        'ê¸°íƒ€(ìƒì‹)': ['ê³¨ë±…ì´ë¬¼íšŒ']
    },
    'êµ´': {
        'ë°¥/ì£½': ['êµ´êµ­ë°¥'],
        'ë©´ë¥˜': ['êµ´ì¹¼êµ­ìˆ˜', 'êµ´ì§¬ë½•'],
        'êµ­/íƒ•': ['ë§¤ìƒì´êµ´êµ­', 'êµ´ìˆœë‘ë¶€ì°Œê°œ'],
        'ì¡°ë¦¼': ['êµ´ì¡°ë¦¼'],
        'ì°œ': ['êµ´ì°œ'],
        'ë¬´ì¹¨': ['êµ´ë¬´ì¹¨'],
        'ë³¶ìŒ': ['êµ´ë³¶ìŒ'],
        'ë¶€ì¹¨': ['êµ´ì „'],
        'íŠ€ê¹€': ['êµ´íŠ€ê¹€'],
        'êµ¬ì´': ['êµ´êµ¬ì´'],
        'ê¸°íƒ€(ìƒì‹)': ['ìƒêµ´']
    },
    'ë¯¸ë”ë•': {
        'ë°¥/ì£½': ['ë¯¸ë”ë•ë°¥'],
        'êµ­/íƒ•': ['ë¯¸ë”ë•ëœì¥ì°Œê°œ', 'ë¯¸ë”ë•ìˆœë‘ë¶€ì°Œê°œ'],
        'ì°œ': ['ë¯¸ë”ë•ì½©ë‚˜ë¬¼ì°œ']
    },
    'ë°”ì§€ë½': {
        'ë°¥/ì£½': ['ë°”ì§€ë½ë¹„ë¹”ë°¥'],
        'ë©´ë¥˜': ['ë°”ì§€ë½ì¹¼êµ­ìˆ˜'],
        'êµ­/íƒ•': ['ë°”ì§€ë½ë¯¸ì—­êµ­', 'ë°”ì§€ë½ìˆœë‘ë¶€ì°Œê°œ'],
        'ì°œ': ['ë°”ì§€ë½ì°œ'],
        'ë¬´ì¹¨': ['ë°”ì§€ë½ë¬´ì¹¨'],
        'ë³¶ìŒ': ['ë°”ì§€ë½ë³¶ìŒ', 'ë§¤ì½¤ë°”ì§€ë½ë³¶ìŒ'],
        'ë¶€ì¹¨': ['ë°”ì§€ë½ë¶€ì¶”ì „']
    },
    'ë°±í•©': {
        'ë°¥/ì£½': ['ë°±í•©ë³¶ìŒë°¥'],
        'ë©´ë¥˜': ['ë°±í•©ì¹¼êµ­ìˆ˜'],
        'êµ­/íƒ•': ['ë°±í•©íƒ•'],
        'ì°œ': ['ë°±í•©ì°œ'],
        'ë¬´ì¹¨': ['ë°±í•©ë¬´ì¹¨'],
        'ë³¶ìŒ': ['ë°±í•©ë³¶ìŒ'],
        'êµ¬ì´': ['ë°±í•©êµ¬ì´']
    },
    'ì†Œë¼': {
        'ë°¥/ì£½': ['ì°¸ì†Œë¼ì•¼ì±„ì£½'],
        'ë©´ë¥˜': ['ì†Œë¼ë¹„ë¹”ë©´'],
        'êµ­/íƒ•': ['ì†Œë¼ëœì¥ì°Œê°œ'],
        'ì¡°ë¦¼': ['ì°¸ì†Œë¼ì¥ì¡°ë¦¼'],
        'ì°œ': ['ì†Œë¼ìˆ™íšŒ'],
        'ë¬´ì¹¨': ['ì†Œë¼ë¬´ì¹¨'],
        'ë³¶ìŒ': ['ì†Œë¼ë²„í„°ë³¶ìŒ'],
        'íŠ€ê¹€': ['ì†Œë¼íŠ€ê¹€'],
        'êµ¬ì´': ['ì†Œë¼êµ¬ì´'],
        'ê¸°íƒ€(ìƒì‹)': ['ì†Œë¼íšŒ']
    },
    'ì¬ì²©': {
        'êµ­/íƒ•': ['ì¬ì²©êµ­'],
        'ë¬´ì¹¨': ['ì¬ì²©ë¬´ì¹¨'],
        'ë¶€ì¹¨': ['ì¬ì²©ë¶€ì¶”ì „']
    },
    'ì „ë³µ': {
        'ë°¥/ì£½': ['ì „ë³µì£½'],
        'ë©´ë¥˜': ['ì „ë³µíŒŒìŠ¤íƒ€'],
        'êµ­/íƒ•': ['ì „ë³µë¯¸ì—­êµ­'],
        'ì¡°ë¦¼': ['ì „ë³µì¥ì¡°ë¦¼'],
        'ì°œ': ['ì „ë³µì°œ'],
        'ë¬´ì¹¨': ['ì „ë³µë¬´ì¹¨'],
        'ë³¶ìŒ': ['ì „ë³µë³¶ìŒ'],
        'êµ¬ì´': ['ì „ë³µêµ¬ì´'],
        'ê¸°íƒ€(ìƒì‹)': ['ì „ë³µíšŒ']
    },
    'í™í•©': {
        'ë°¥/ì£½': ['í™í•©ì£½'],
        'ë©´ë¥˜': ['í™í•©ì¹¼êµ­ìˆ˜', 'í™í•©ì§¬ë½•'],
        'êµ­/íƒ•': ['í™í•©íƒ•', 'í™í•©ëœì¥ì°Œê°œ'],
        'ì¡°ë¦¼': ['í™í•©ì¡°ë¦¼'],
        'ì°œ': ['í™í•©ì°œ'],
        'ë¬´ì¹¨': ['í™í•©ë¬´ì¹¨'],
        'ë³¶ìŒ': ['í™í•©ë³¶ìŒ'],
        'ë¶€ì¹¨': ['í™í•©ì „'],
        'êµ¬ì´': ['í™í•©êµ¬ì´']
    },
    'ê°€ìë¯¸': {
        'êµ­/íƒ•': ['ê°€ìë¯¸ë¯¸ì—­êµ­'],
        'ì¡°ë¦¼': ['ê°€ìë¯¸ì¡°ë¦¼'],
        'ì°œ': ['ê°€ìë¯¸ì°œ'],
        'ë¶€ì¹¨': ['ê°€ìë¯¸ì „'],
        'íŠ€ê¹€': ['ê°€ìë¯¸íŠ€ê¹€'],
        'êµ¬ì´': ['ê°€ìë¯¸êµ¬ì´']
    },
    'ë‹¤ë‘ì–´': {
        'ë°¥/ì£½': ['ì°¸ì¹˜ê¹€ë°¥'],
        'êµ­/íƒ•': ['ì°¸ì¹˜ê¹€ì¹˜ì°Œê°œ'],
        'ë³¶ìŒ': ['ì°¸ì¹˜ì–‘ë°°ì¶”ë³¶ìŒ'],
        'ë¶€ì¹¨': ['ì°¸ì¹˜ë‹¬ê±€ë§ì´'],
        'êµ¬ì´': ['ì°¸ì¹˜ìŠ¤í…Œì´í¬'],
        'ìƒì‹ë¥˜/ì ˆì„ë¥˜/ì¥ë¥˜': ['ì°¸ì¹˜íšŒ']
    },
    'ê³ ë“±ì–´': {
        'ì¡°ë¦¼': ['ê³ ë“±ì–´ì¡°ë¦¼'],
        'êµ¬ì´': ['ê³ ë“±ì–´êµ¬ì´']
    },
    'ê°ˆì¹˜': {
        'ì¡°ë¦¼': ['ê°ˆì¹˜ì¡°ë¦¼'],
        'êµ¬ì´': ['ê°ˆì¹˜êµ¬ì´']
    },
    'ê½ì¹˜': {
        'êµ­/íƒ•': ['ê½ì¹˜ê¹€ì¹˜ì°Œê°œ'],
        'ì¡°ë¦¼': ['ê½ì¹˜ì¡°ë¦¼'],
        'êµ¬ì´': ['ê½ì¹˜êµ¬ì´']
    },
    'ëŒ€êµ¬': {
        'êµ­/íƒ•': ['ë§‘ì€ëŒ€êµ¬íƒ•', 'ëŒ€êµ¬ë§¤ìš´íƒ•'],
        'ì¡°ë¦¼': ['ëŒ€êµ¬ì¡°ë¦¼'],
        'ë¶€ì¹¨': ['ëŒ€êµ¬ì „']
    },
    'ë©¸ì¹˜': {
        'ë°¥/ì£½': ['ë©¸ì¹˜ê¹€ë°¥'],
        'ë³¶ìŒ': ['ë©¸ì¹˜ë³¶ìŒ']
    },
    'ëª…íƒœ': {
        'êµ­/íƒ•': ['í™©íƒœë¯¸ì—­êµ­'],
        'ì¡°ë¦¼': ['ì½”ë‹¤ë¦¬ì¡°ë¦¼'],
        'ì°œ': ['ëª…íƒœì°œ'],
        'ë¬´ì¹¨': ['ë¶ì–´ì±„ë¬´ì¹¨'],
        'êµ¬ì´': ['ì½”ë‹¤ë¦¬êµ¬ì´']
    },
    'ë°•ëŒ€': {
        'ì¡°ë¦¼': ['ë°•ëŒ€ì¡°ë¦¼'],
        'êµ¬ì´': ['ë°•ëŒ€êµ¬ì´']
    },
    'ë±…ì–´': {
        'ë¬´ì¹¨': ['ë±…ì–´í¬ë¬´ì¹¨'],
        'íŠ€ê¹€': ['ë±…ì–´í¬íŠ€ê¹€']
    },
    'ë³‘ì–´': {
        'ì¡°ë¦¼': ['ë³‘ì–´ì¡°ë¦¼'],
        'êµ¬ì´': ['ë³‘ì–´êµ¬ì´']
    },
    'ì‚¼ì¹˜': {
        'ì¡°ë¦¼': ['ì‚¼ì¹˜ì¡°ë¦¼'],
        'íŠ€ê¹€': ['ì‚¼ì¹˜íŠ€ê¹€'],
        'êµ¬ì´': ['ì‚¼ì¹˜êµ¬ì´']
    },
    'ì•„ê·€': {
        'êµ­/íƒ•': ['ì•„ê·€íƒ•'],
        'ì°œ': ['ì•„ê·€ì°œ']
    },
    'ì—°ì–´': {
        'ë°¥/ì£½': ['ì—°ì–´ë®ë°¥'],
        'êµ¬ì´': ['ì—°ì–´êµ¬ì´'],
        'ìƒì‹ë¥˜/ì ˆì„ë¥˜/ì¥ë¥˜': ['ì—°ì–´íšŒ']
    },
    'ì„ì—°ìˆ˜': {
        'ì¡°ë¦¼': ['ì„ì—°ìˆ˜ì¡°ë¦¼'],
        'êµ¬ì´': ['ì„ì—°ìˆ˜êµ¬ì´']
    },
    'ì¥ì–´': {
        'ë°¥/ì£½': ['ì¥ì–´ë®ë°¥'],
        'ì¡°ë¦¼': ['ì¥ì–´ì¡°ë¦¼'],
        'ì°œ': ['ì¥ì–´ì°œ'],
        'íŠ€ê¹€': ['ì¥ì–´íŠ€ê¹€'],
        'êµ¬ì´': ['ì¥ì–´êµ¬ì´']
    },
    'ì¡°ê¸°': {
        'ì¡°ë¦¼': ['ì¡°ê¸°ì¡°ë¦¼'],
        'ì°œ': ['ì¡°ê¸°ì°œ'],
        'êµ¬ì´': ['ì¡°ê¸°êµ¬ì´']
    }
}

# âœ… ì„¸ì…˜ ì´ˆê¸°í™”
if "step" not in st.session_state:
    st.session_state.step = "info"
if "selected_ingredients" not in st.session_state:
    st.session_state.selected_ingredients = []
if "selected_menus" not in st.session_state:
    st.session_state.selected_menus = {}

# âœ… CSS ìŠ¤íƒ€ì¼ (HTML ë””ìì¸ ì°¸ê³ )
st.markdown("""
<style>
body { background: #fafafa; }
.category-title {
    background:linear-gradient(135deg,#667eea,#764ba2);
    color:white; text-align:center; font-size:1.3em; font-weight:600;
    padding:10px; border-radius:8px; margin:25px 0 10px;
}
.ingredient-grid, .menu-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
}
.card {
    background: #f8f9fa; border:2px solid #e9ecef; border-radius:10px;
    padding:10px; text-align:center; cursor:pointer;
    transition: all 0.3s ease; box-shadow:0 3px 8px rgba(0,0,0,0.05);
}
.card:hover { transform:translateY(-3px); box-shadow:0 6px 15px rgba(0,0,0,0.1); }
.card img { width:200px; height:120px; object-fit:cover; border-radius:8px; }
.card p { font-weight:600; font-size:1.1em; margin-top:5px; }
.card.selected { background:linear-gradient(135deg,#667eea,#764ba2); color:white; border-color:#667eea; }
</style>
""", unsafe_allow_html=True)

# âœ… ì´ë¯¸ì§€ Base64 ë³€í™˜
def image_to_base64(img):
    if img is None:
        return ""
    from io import BytesIO
    buf = BytesIO()
    img.save(buf, format="PNG")
    return base64.b64encode(buf.getvalue()).decode()

# âœ… ì´ë¯¸ì§€ ë¡œë“œ
def load_img(path):
    return Image.open(path) if os.path.exists(path) else None

# âœ… ì¬ë£Œ ì¹´ë“œ ë Œë”ë§
def render_card(label, img, is_selected):
    img64 = image_to_base64(img) if img else ""
    cls = "card selected" if is_selected else "card"
    return f"""
    <div class="{cls}">
        <img src="data:image/png;base64,{img64}">
        <p>{label}</p>
    </div>
    """

# âœ… 1ë‹¨ê³„: ì°¸ì—¬ì ì •ë³´ ì…ë ¥
def show_info():
    st.title("ğŸŒŠ ë¸”ë£¨í‘¸ë“œ ì„ í˜¸ë„ ì¡°ì‚¬")
    name = st.text_input("ì„±í•¨", placeholder="í™ê¸¸ë™")
    idn = st.text_input("ì‹ë³„ë²ˆí˜¸", placeholder="ì˜ˆ: 2024001")
    if st.button("ì„¤ë¬¸ ì‹œì‘í•˜ê¸°", type="primary"):
        if name and idn:
            st.session_state.name = name
            st.session_state.idn = idn
            st.session_state.step = "ingredients"
            st.rerun()
        else:
            st.error("âš ï¸ ì„±í•¨ê³¼ ì‹ë³„ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.")

# âœ… 2ë‹¨ê³„: ìˆ˜ì‚°ë¬¼ ì„ íƒ
def show_ingredients():
    st.subheader("ğŸŸ ìˆ˜ì‚°ë¬¼ ì›ì¬ë£Œ ì„ íƒ")
    st.info("ìµœì†Œ 3ê°œ ì´ìƒ, ìµœëŒ€ 9ê°œê¹Œì§€ ì„ íƒí•´ì£¼ì„¸ìš”.")

    for category, items in INGREDIENT_CATEGORIES.items():
        st.markdown(f"<div class='category-title'>{category}</div>", unsafe_allow_html=True)
        st.markdown("<div class='ingredient-grid'>", unsafe_allow_html=True)

        for ingredient in items:
            jpg = os.path.join(IMAGE_PATH, f"{ingredient}.jpg")
            png = os.path.join(IMAGE_PATH, f"{ingredient}.png")
            img = load_img(jpg) or load_img(png)
            selected = ingredient in st.session_state.selected_ingredients

            if st.button(f"ì„ íƒ_{ingredient}", key=f"ing_btn_{ingredient}"):
                if selected:
                    st.session_state.selected_ingredients.remove(ingredient)
                else:
                    if len(st.session_state.selected_ingredients) < 9:
                        st.session_state.selected_ingredients.append(ingredient)
                    else:
                        st.warning("âŒ ìµœëŒ€ 9ê°œê¹Œì§€ ì„ íƒ ê°€ëŠ¥")
                st.rerun()

            st.markdown(render_card(ingredient, img, selected), unsafe_allow_html=True)

        st.markdown("</div>", unsafe_allow_html=True)

    # âœ… ìƒíƒœ í‘œì‹œ
    count = len(st.session_state.selected_ingredients)
    if 3 <= count <= 9:
        st.success(f"âœ… í˜„ì¬ {count}ê°œ ì„ íƒë¨")
    elif count < 3:
        st.warning(f"âš ï¸ {count}ê°œ ì„ íƒë¨ (3ê°œ ì´ìƒ í•„ìš”)")
    else:
        st.error(f"âŒ {count}ê°œ ì„ íƒë¨ (ìµœëŒ€ 9ê°œ)")

    # âœ… ë‹¤ìŒ ë²„íŠ¼
    if 3 <= count <= 9:
        if st.button("ë‹¤ìŒ ë‹¨ê³„ë¡œ â†’", type="primary"):
            st.session_state.selected_menus = {i: [] for i in st.session_state.selected_ingredients}
            st.session_state.step = "menus"
            st.rerun()
    else:
        st.button("ë‹¤ìŒ ë‹¨ê³„ë¡œ â†’", disabled=True)

# âœ… 3ë‹¨ê³„: ë©”ë‰´ ì„ íƒ
def show_menus():
    st.subheader("ğŸ½ï¸ ë©”ë‰´ ì„ íƒ")
    st.info("ê° ìˆ˜ì‚°ë¬¼ë§ˆë‹¤ ìµœì†Œ 1ê°œ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”.")

    all_valid = True
    for ing in st.session_state.selected_ingredients:
        st.markdown(f"<div class='category-title'>ğŸŸ {ing} ë©”ë‰´</div>", unsafe_allow_html=True)
        menus = MENU_DATA.get(ing, [])
        st.markdown("<div class='menu-grid'>", unsafe_allow_html=True)

        for menu in menus:
            jpg = os.path.join(MENU_IMAGE_PATH, f"{menu}.jpg")
            png = os.path.join(MENU_IMAGE_PATH, f"{menu}.png")
            img = load_img(jpg) or load_img(png)
            selected = menu in st.session_state.selected_menus[ing]

            if st.button(f"ì„ íƒ_{ing}_{menu}", key=f"menu_btn_{ing}_{menu}"):
                if selected:
                    st.session_state.selected_menus[ing].remove(menu)
                else:
                    st.session_state.selected_menus[ing].append(menu)
                st.rerun()
                
            st.markdown(render_card(menu, img, selected), unsafe_allow_html=True)

        st.markdown("</div>", unsafe_allow_html=True)

        if len(st.session_state.selected_menus[ing]) == 0:
            all_valid = False
            st.warning(f"âš ï¸ {ing} ë©”ë‰´ ìµœì†Œ 1ê°œ ì„ íƒ í•„ìš”")
        else:
            st.success(f"âœ… {ing}: {len(st.session_state.selected_menus[ing])}ê°œ ì„ íƒë¨")

    # âœ… ë²„íŠ¼
    col1, col2 = st.columns(2)
    with col1:
        if st.button("â† ì´ì „ ë‹¨ê³„"):
            st.session_state.step = "ingredients"
            st.rerun()
    with col2:
        if all_valid:
            if st.button("ì„¤ë¬¸ ì™„ë£Œí•˜ê¸°", type="primary"):
                st.session_state.step = "complete"
                st.rerun()
        else:
            st.button("ì„¤ë¬¸ ì™„ë£Œí•˜ê¸°", disabled=True)

# âœ… 4ë‹¨ê³„: ì™„ë£Œ í˜ì´ì§€
def show_complete():
    st.balloons()
    st.success("ğŸ‰ ì„¤ë¬¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì°¸ì—¬í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤!")

    # ê²°ê³¼ ìš”ì•½
    st.write("### âœ… ì„ íƒëœ ìˆ˜ì‚°ë¬¼")
    st.write(", ".join(st.session_state.selected_ingredients))

    st.write("### âœ… ì„ íƒëœ ë©”ë‰´")
    for ing, menus in st.session_state.selected_menus.items():
        st.write(f"- {ing}: {', '.join(menus)}")

    if st.button("ğŸ”„ ìƒˆ ì„¤ë¬¸ ì‹œì‘í•˜ê¸°"):
        for k in list(st.session_state.keys()):
            del st.session_state[k]
        st.rerun()

# âœ… í˜ì´ì§€ ë¼ìš°íŒ…
if st.session_state.step == "info":
    show_info()
elif st.session_state.step == "ingredients":
    show_ingredients()
elif st.session_state.step == "menus":
    show_menus()
else:
    show_complete()
